dnl Process this file with autoconf to produce a configure script.

AC_INIT(Makefile.conf.in)
AC_PREFIX_DEFAULT(/usr)

dnl Checks for programs.
AC_PROG_CC
AC_PROG_RANLIB
AC_PROG_INSTALL
AC_PROG_LN_S 

dnl Checks for header files.
AC_HEADER_STDC
AC_CONFIG_HEADER(include/config.h)
AC_CHECK_HEADERS(linux/sound.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_C_INLINE
AC_C_BIGENDIAN
AC_HEADER_TIME

dnl Checks for library functions.
AC_PROG_GCC_TRADITIONAL

dnl Check for ALSA driver package.
myprefix=$prefix
if test "$myprefix" = "NONE"; then
  myprefix=$ac_default_prefix
fi
CFLAGS="-I$myprefix/include"
#echo "CFLAGS=$CFLAGS"
AC_MSG_CHECKING(for alsa-driver package)
AC_TRY_RUN([
#include <linux/sound.h>
void main(void)
{
#ifndef SND_PROTOCOL_VERSION
  exit(1);
#else
  exit(0);
#endif
}
],
  AC_MSG_RESULT("present"),
  AC_MSG_RESULT("not found"); echo "Fatal error: Install alsa-driver package at first..."; exit 1;,
  AC_MSG_RESULT("not supported"); echo "Fatal error: Cross-compiling isn't supported..."; exit 1;,
)

dnl Check for version...
AC_MSG_CHECKING(for library version)
SND_LIB_VERSION=`cat $srcdir/version`
AC_DEFINE_UNQUOTED(SND_LIB_VERSION, "$SND_LIB_VERSION")
AC_SUBST(SND_LIB_VERSION)
SND_LIB_MAJOR=`echo $SND_LIB_VERSION | cut -d . -f 1`
AC_SUBST(SND_LIB_MAJOR)
SND_LIB_MINOR=`echo $SND_LIB_VERSION | cut -d . -f 2`
AC_SUBST(SND_LIB_MINOR)
SND_LIB_SUBMINOR=`echo $SND_LIB_VERSION | cut -d . -f 3`
AC_SUBST(SND_LIB_SUBMINOR)
AC_MSG_RESULT($SND_LIB_VERSION)

AC_OUTPUT(Makefile.conf include/version.h utils/alsa-lib.spec)
